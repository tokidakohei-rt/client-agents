# Pipedrive アクションログスキーマ

## 概要

エージェントが実行したアクションをPipedriveのノート（Notes）として記録するためのスキーマ定義です。

---

## ログフォーマット

### 基本構造

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | {YYYY-MM-DD HH:MM:SS} |
| **Agent** | {AGENT_ID} ({AGENT_NAME}) |
| **Action** | {ACTION_SUMMARY} |
| **Target** | {DEAL/PERSON/ORGANIZATION} |

### Details
{ACTION_DETAILS}

### Next Action
{RECOMMENDED_NEXT_ACTION}

### Confidence
{HIGH/MEDIUM/LOW}

---
*This log was automatically generated by Client Management Agents v1.0*
```

---

## フィールド定義

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| Timestamp | datetime | ✅ | アクション実行日時 |
| Agent | string | ✅ | 実行したエージェントID+名前 |
| Action | string | ✅ | アクションの要約（1行） |
| Target | string | ✅ | 対象のリソース（Deal/Person/Org） |
| Details | markdown | ✅ | アクションの詳細 |
| Next Action | string | ○ | 推奨する次のアクション |
| Confidence | enum | ✅ | 信頼度（High/Medium/Low） |

---

## アクションタイプ別テンプレート

### 1. ステージ移動

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | 2026-01-20 15:30:00 |
| **Agent** | EX (Executor) |
| **Action** | ステージ移動 |
| **Target** | Deal: ABC株式会社 案件 |

### Details
- **変更前ステージ**: Proposal（提案）
- **変更後ステージ**: Negotiation（交渉）
- **理由**: 提案に対するポジティブなフィードバックを受領

### Next Action
- 1週間以内に契約条件の詳細を詰める
- 決裁者へのプレゼン日程を調整

### Confidence
High

---
*This log was automatically generated by Client Management Agents v1.0*
```

### 2. フォローアップメール作成

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | 2026-01-20 14:00:00 |
| **Agent** | EX (Executor) |
| **Action** | フォローアップメール作成 |
| **Target** | Person: 田中太郎（XYZ株式会社） |

### Details
- **メール種類**: 提案後フォローアップ
- **主な内容**: 
  - 先日の提案へのお礼
  - 追加資料の提供
  - 次回MTG日程の確認
- **送信予定**: 2026-01-21 10:00

### Next Action
- 3営業日後に電話フォロー
- 返信がない場合、別アプローチを検討

### Confidence
High

---
*This log was automatically generated by Client Management Agents v1.0*
```

### 3. アクティビティ作成

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | 2026-01-20 16:00:00 |
| **Agent** | EX (Executor) |
| **Action** | アクティビティ作成 |
| **Target** | Deal: DEF株式会社 導入支援 |

### Details
- **アクティビティタイプ**: Meeting
- **件名**: オンボーディングキックオフMTG
- **予定日時**: 2026-01-25 14:00-15:30
- **参加者**: 
  - 先方: 佐藤部長、鈴木課長
  - 当社: 営業担当、CSチーム

### Next Action
- MTG前日にアジェンダ送付
- 初期設定資料の準備

### Confidence
High

---
*This log was automatically generated by Client Management Agents v1.0*
```

### 4. リスクアラート記録

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | 2026-01-20 11:00:00 |
| **Agent** | RP (Risk Predictor) |
| **Action** | リスクアラート発行 |
| **Target** | Deal: GHI株式会社 年間契約 |

### Details
- **リスクスコア**: 75/100 (High)
- **検出されたリスク要因**:
  - 最終コンタクトから45日経過
  - 直近のフィードバックにネガティブな言及あり
  - 競合サービスへの問い合わせ兆候
- **推定チャーン確率**: 40%

### Next Action
- 即座に電話でコンタクト
- 課題ヒアリングと解決策提示
- 必要に応じて特別条件の検討

### Confidence
Medium

---
*This log was automatically generated by Client Management Agents v1.0*
```

### 5. ヘルススコア更新

```markdown
## 🤖 Agent Action Log

| 項目 | 内容 |
|------|------|
| **Timestamp** | 2026-01-20 09:00:00 |
| **Agent** | CT (Client Triager) |
| **Action** | ヘルススコア更新 |
| **Target** | Organization: JKL株式会社 |

### Details
- **前回スコア**: 65/100 (Medium)
- **今回スコア**: 82/100 (High)
- **スコア変動要因**:
  - エンゲージメント: +10（週3回のログイン）
  - 商談進捗: +5（新規案件追加）
  - 拡大機会: +2（追加機能の問い合わせ）

### Next Action
- アップセル提案の準備
- 成功事例としてケーススタディ作成を検討

### Confidence
High

---
*This log was automatically generated by Client Management Agents v1.0*
```

---

## Confidence レベル定義

| レベル | 定義 | 使用場面 |
|--------|------|---------|
| **High** | データに基づく確実な判断 | 明確なデータ、過去の実績あり |
| **Medium** | 推測を含むが妥当な判断 | 一部推測、傾向に基づく |
| **Low** | 不確実性が高い判断 | データ不足、新規パターン |

---

## Pipedrive API 呼び出し

### ノート追加

```
POST /notes

{
  "content": "{FORMATTED_LOG_CONTENT}",
  "deal_id": {DEAL_ID},        // または
  "person_id": {PERSON_ID},    // または
  "org_id": {ORG_ID}
}
```

### 関連付け優先順位

1. Deal（商談）に関連 → `deal_id` を使用
2. Person（担当者）に関連 → `person_id` を使用
3. Organization（企業）に関連 → `org_id` を使用

---

## 検索・フィルタリング

### ログの検索

ノート内容に `🤖 Agent Action Log` を含むものをフィルタ：

```
GET /notes?deal_id={id}

→ content に "Agent Action Log" を含むものを抽出
```

### エージェント別フィルタ

```
content に "Agent**: EX" を含む → Executorのログ
content に "Agent**: RP" を含む → Risk Predictorのログ
```

---

## ベストプラクティス

### DO ✅

- ✅ すべての重要アクションをログに記録
- ✅ Next Actionを必ず記載
- ✅ Confidenceを適切に設定
- ✅ 具体的な詳細を含める

### DON'T ❌

- ❌ 軽微な操作（情報取得のみ）はログ不要
- ❌ 機密情報（パスワード等）を含めない
- ❌ 過度に長いログ（簡潔に）
