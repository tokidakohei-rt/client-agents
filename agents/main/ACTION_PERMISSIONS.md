# Action Permissions

## 概要
このドキュメントは、Pipedriveアクションの承認要否を定義します。
エージェントは本ルールに従い、承認不要アクションは即実行、承認必要アクションはユーザー確認を経て実行します。

---

## 🟢 承認不要（即実行）

以下のアクションは、エージェントの判断で即座に実行可能です。

| アクション | API Endpoint | 説明 |
|-----------|--------------|------|
| **ステージ移動** | `PUT /deals/{id}` | Dealのステージを変更 |
| **ノート追加** | `POST /notes` | Deal/Person/Orgにメモを追加 |
| **アクティビティ作成** | `POST /activities` | タスク・MTG・コールなどを登録 |
| **アクティビティ更新** | `PUT /activities/{id}` | アクティビティ内容の修正 |
| **アクティビティ完了** | `PUT /activities/{id}` | 完了マーク（done: true） |
| **フォローアップ設定** | `POST /activities` | リマインダー・フォローアップタスク作成 |
| **ラベル追加/変更** | `PUT /deals/{id}` | Dealのラベル変更 |
| **データ取得（全般）** | `GET /*` | 全ての読み取り操作 |

### 実行時のルール
- 実行後、必ずアクションログをノートとして記録する
- 変更内容を簡潔にユーザーに報告する

---

## 🟡 承認必要

以下のアクションは、**必ずユーザーの明示的な承認を得てから**実行します。

| アクション | API Endpoint | 理由 |
|-----------|--------------|------|
| **Deal削除** | `DELETE /deals/{id}` | 不可逆操作、データ消失リスク |
| **Person削除** | `DELETE /persons/{id}` | 不可逆操作、データ消失リスク |
| **Organization削除** | `DELETE /organizations/{id}` | 不可逆操作、データ消失リスク |
| **Deal金額変更** | `PUT /deals/{id}` (value) | 財務・レポートへの影響 |
| **Deal Lost処理** | `PUT /deals/{id}` (status=lost) | 重要なビジネス判断 |
| **Deal Won処理** | `PUT /deals/{id}` (status=won) | 重要なビジネス判断 |
| **担当者変更** | `PUT /deals/{id}` (user_id) | 責任範囲の変更 |
| **メール送信** | 外部API | 外部へのコミュニケーション |
| **一括操作** | Bulk API | 複数レコードへの影響 |

### 承認フロー
1. エージェントが実行内容を明確に提示
2. 変更の影響範囲を説明
3. ユーザーが「実行して」「OK」等で明示的に承認
4. 承認後に実行
5. 結果をユーザーに報告

---

## 判断基準

アクションが上記リストにない場合、以下の基準で判断：

### 承認不要の条件
- 情報の追加・記録のみ（ノート、アクティビティ）
- 読み取り専用操作
- 日常的なステータス更新
- 影響がDeal/Person単位で限定的

### 承認必要の条件
- データの削除・消失を伴う
- 外部（クライアント等）への影響がある
- 金額・財務に関わる変更
- ビジネス上の重要判断を伴う（Won/Lost等）
- 複数レコードに一括で影響

---

## 更新履歴

| 日付 | 変更内容 |
|------|----------|
| 2026-01-20 | 初版作成 |
