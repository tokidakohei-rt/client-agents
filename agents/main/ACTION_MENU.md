# Action Menu - アクションメニュー標準フォーマット v1.0

## 概要

このドキュメントは、各エージェントの出力末尾に付与する
「次のアクション」メニューの標準フォーマットを定義します。

これにより、ユーザーは簡単な入力で次のアクションを選択でき、
エージェントは継続的に連携して動作できます。

---

## 基本フォーマット

```markdown
---

## 📋 次のアクション

以下から選択してください:

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 🔍 [対象] を詳しく診断 | CTでクライアント診断 |
| 2 | ⚠️ [対象] のリスク分析 | RPでリスク評価 |
| 3 | 📧 [対象] にメール作成 | EXでメール下書き |
| 4 | ✅ 完了 | ここで終了 |

→ 番号を入力（例: `1` または `1, 3`）:
```

---

## アクションアイコン凡例

| アイコン | 意味 | 起動エージェント |
|---------|------|----------------|
| 🔍 | 詳細診断・調査 | CT, FM |
| ⚠️ | リスク分析 | RP |
| 📧 | メール作成 | EX |
| 📞 | コール・連絡 | EX, CM |
| 📅 | 日程調整 | SC |
| ✏️ | Pipedrive更新 | EX |
| 📊 | レポート作成 | FM, RV |
| ➡️ | 次ステップへ | （ワークフロー継続）|
| ✅ | 完了 | （終了）|
| ⏭️ | スキップ | （次ステップへ）|

---

## エージェント別メニューテンプレート

### FM（ファネルモニター）出力後

```markdown
---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 🔍 **[Client A]** を詳しく診断 | ヘルススコア低下のため |
| 2 | 🔍 **[Client B]** を詳しく診断 | 長期滞留のため |
| 3 | 🔍 **[Client C]** を詳しく診断 | 契約更新間近のため |
| 4 | ⚠️ 全体のリスクスキャン | High Riskクライアントを特定 |
| 5 | 📊 **[ステージ名]** を深掘り | ボトルネックの詳細分析 |
| 6 | ➡️ 推奨クライアント全員を診断 | 上位3件をまとめて診断 |
| 7 | ✅ 完了 | レポートのみで終了 |

→ 番号を入力:
```

### CT（クライアントトリアージャー）出力後

```markdown
---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | ⚠️ **[Client名]** のリスク分析 | チャーンリスクを詳細評価 |
| 2 | 📧 フォローアップメール作成 | 推奨アクション①の実行 |
| 3 | 📅 MTG日程調整 | 推奨アクション②の実行 |
| 4 | ✏️ ステージを **[ステージ名]** に移動 | 即実行 |
| 5 | ✏️ ノートを追加 | 診断結果を記録 |
| 6 | 🔍 別のクライアントを診断 | クライアント名を指定 |
| 7 | ✅ 完了 | 診断のみで終了 |

→ 番号を入力:
```

### RP（リスクプレディクター）出力後

```markdown
---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 📧 緊急フォローアップメール作成 | 即時介入 |
| 2 | 📞 コールスクリプト作成 | 電話でのフォロー |
| 3 | 📅 緊急MTG設定 | 日程調整開始 |
| 4 | 🔍 他のHigh Riskクライアントを診断 | [Client B] を診断 |
| 5 | ✏️ リスクフラグをPipedriveに記録 | ノート追加 |
| 6 | ✅ 完了 | リスク分析のみで終了 |

→ 番号を入力:
```

### EX（エグゼキューター）出力後

```markdown
---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 📧 メールを送信 | ⚠️ 承認後に送信 |
| 2 | ✏️ メールを修正 | 内容を編集 |
| 3 | 📅 次回フォローアップを設定 | アクティビティ作成 |
| 4 | 🔍 次のクライアントを対応 | [Client B] へ移行 |
| 5 | 📊 本日の対応サマリー | RVでまとめ |
| 6 | ✅ 完了 | ここで終了 |

→ 番号を入力:
```

### SC（スケジューラー）出力後

```markdown
---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 📧 日程候補をメールで送信 | EXでメール作成 |
| 2 | 📅 別の候補を探す | 条件を変更して再検索 |
| 3 | ✏️ カレンダーに仮押さえ | アクティビティ作成 |
| 4 | 🔍 次のクライアントの日程調整 | 別クライアントへ |
| 5 | ✅ 完了 | 日程調整終了 |

→ 番号を入力:
```

---

## 入力パターン

### 単一選択

```
1
```
→ アクション1を実行

### 複数選択

```
1, 3
```
→ アクション1と3を順次実行

### 条件付き選択

```
2 for Client A
```
→ アクション2をClient Aに対して実行

### 自然言語

```
Client Aにメール作成して
```
→ DPが解釈して適切なアクションを実行

### 終了

```
done
ok
完了
```
→ ワークフロー終了

---

## メニュー生成ルール

### 必須項目

1. **完了オプション** - 必ず「✅ 完了」を含める
2. **推奨アクションの強調** - 最も推奨するものに ⭐ を付ける
3. **説明** - なぜそのアクションが推奨されるか簡潔に

### 項目数

- **最小**: 3項目（推奨アクション + 別アクション + 完了）
- **最大**: 7項目（選択肢が多すぎると認知負荷）
- **推奨**: 4-5項目

### 優先度順

1. 最も推奨されるアクション（⭐マーク）
2. 次に推奨されるアクション
3. 代替アクション
4. スキップ/次へ
5. 完了

---

## コンテキスト引き継ぎ

ユーザーが選択したら、以下の情報を次のエージェントに渡す:

```yaml
action_context:
  selected_action: 1
  action_type: "client_diagnosis"
  target:
    type: "client"
    id: 123
    name: "Client A"
  previous_agent: "FM"
  previous_output_summary: |
    ボトルネック: Proposal → Won (CVR 15%)
    要注意クライアント: Client A (ヘルススコア低下)
  workflow:
    id: "WF-001"
    step: 2
```

---

## 実装チェックリスト

各エージェントの出力に以下を確認:

- [ ] `## 📋 次のアクション` セクションがある
- [ ] テーブル形式で選択肢が提示されている
- [ ] 各選択肢にアイコンがある
- [ ] 「✅ 完了」オプションがある
- [ ] 最推奨アクションが明確
- [ ] 入力プロンプト `→ 番号を入力:` がある

---

## 例: 完全な出力フロー

### Step 1: FM出力

```markdown
## ファネル分析レポート

### ファネル概要
| ステージ | 件数 | CVR |
|---------|------|-----|
| Lead | 50 | - |
| Appointment | 30 | 60% |
| Proposal | 15 | 50% |
| Won | 3 | 20% ⚠️ |

### ボトルネック
- **Proposal → Won**: CVR 20%（目標: 40%）

### 要注意クライアント
1. Client A - 45日滞留
2. Client B - ヘルススコア低下
3. Client C - 契約更新30日前

---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 🔍 **Client A** を詳しく診断 | ⭐ 最推奨: 45日滞留 |
| 2 | 🔍 **Client B** を詳しく診断 | ヘルススコア低下 |
| 3 | 🔍 **Client C** を詳しく診断 | 更新間近 |
| 4 | ➡️ 上位3件をまとめて診断 | 時間短縮 |
| 5 | ✅ 完了 | レポートのみ |

→ 番号を入力:
```

### ユーザー入力

```
1
```

### Step 2: CT起動（Client A）

```markdown
## クライアント診断: Client A

### ヘルススコア: 45/100 (Low)

### 診断結果
- 最終コンタクト: 14日前
- 直近メール: 未返信あり
- リスク: Medium-High

### 推奨アクション
1. フォローアップメール送信
2. 1週間以内にMTG設定

---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 📧 フォローアップメール作成 | ⭐ 最推奨 |
| 2 | 📅 MTG日程調整 | 空き時間確認 |
| 3 | ⚠️ リスク詳細分析 | チャーンリスク評価 |
| 4 | ✏️ ノート追加 | 診断結果を記録 |
| 5 | 🔍 Client B を診断 | 次のクライアント |
| 6 | ✅ 完了 | 診断のみ |

→ 番号を入力:
```

### ユーザー入力

```
1, 4
```

### Step 3: EX起動（メール作成 + ノート追加）

```markdown
## ✅ 実行完了

### 1. ノート追加（即実行）
- 対象: Client A (Deal #789)
- 内容: Agent診断結果を記録

### 2. メール下書き

**件名**: NEWT Chatの進捗確認

**本文**:
[メール内容...]

---

## 📋 次のアクション

| # | アクション | 説明 |
|---|-----------|------|
| 1 | 📧 メールを送信 | ⚠️ 承認必要 |
| 2 | ✏️ メールを修正 | 内容を編集 |
| 3 | 📅 フォローアップ設定 | 3日後リマインダー |
| 4 | 🔍 Client B を対応 | 次のクライアント |
| 5 | ✅ 完了 | 本日の対応終了 |

→ 番号を入力:
```

---

このフォーマットにより、ユーザーは最小限の入力で継続的にエージェントを連携させることができます。
